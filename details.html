<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Подробнее — Mini Shop</title>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=106875241', 'ym');

        ym(106875241, 'init', {
            ssr:true,
            webvisor:true,
            clickmap:true,
            ecommerce:"dataLayer",
            referrer: document.referrer,
            url: location.href,
            accurateTrackBounce:true,
            trackLinks:true
        });
    </script>
    <noscript>
        <div>
            <img src="https://mc.yandex.ru/watch/106875241"
                 style="position:absolute; left:-9999px;"
                 alt="" />
        </div>
    </noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S6CLFHHDGH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S6CLFHHDGH');
</script>
    
</head>

<body style="margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
background:
radial-gradient(700px 420px at 20% 10%, rgba(255,79,179,0.18), transparent 60%),
radial-gradient(620px 380px at 85% 15%, rgba(255,134,207,0.12), transparent 60%),
#0b0c10;
color:#f6f7fb;">
  <div style="max-width:980px; margin:0 auto; padding:32px 16px 60px;">
    <div style="padding:22px; border-radius:18px;
background:rgba(20, 12, 22, 0.75);
border:1px solid rgba(255,79,179,0.35);">
      <h1 style="margin:0 0 10px;">Подробнее о продукте</h1>
        <!-- Мини-корзина -->
<div id="miniCart"
  style="margin-top:14px; padding:14px; border-radius:16px;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,79,179,0.28);
  display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">

  <div>
    <div style="font-weight:800;">Корзина</div>
    <div style="font-size:13px; opacity:.85;">
      Товаров: <b id="cartCount">0</b> · Сумма: <b id="cartTotal">0</b> ₽
    </div>
  </div>

  <div style="display:flex; gap:10px; flex-wrap:wrap;">
    <button id="openCartBtn"
      style="cursor:pointer; border:0; border-radius:14px; padding:10px 14px; font-weight:800;
      background:rgba(255,79,179,0.18); color:#fff; border:1px solid rgba(255,79,179,0.35);">
      Открыть
    </button>

    <button id="clearCartBtn"
      style="cursor:pointer; border:0; border-radius:14px; padding:10px 14px; font-weight:800;
      background:rgba(255,255,255,0.06); color:#fff; border:1px solid rgba(255,255,255,0.18);">
      Очистить
    </button>
  </div>
</div>

<!-- Модалка корзины -->
<div id="cartModal"
  style="position:fixed; inset:0; display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.62); padding:16px; z-index:9999; pointer-events:none;">

  <div style="width:min(720px, 96%); border-radius:18px; padding:18px;
    background:rgba(20,12,22,0.92);
    border:1px solid rgba(255,79,179,0.35);
    box-shadow:0 25px 70px rgba(0,0,0,0.65);">

    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px;">
      <div style="font-weight:900; font-size:18px;">Ваша корзина</div>
      <button id="closeCartBtn"
        style="cursor:pointer; border:0; border-radius:12px; padding:8px 12px; font-weight:900;
        background:rgba(255,255,255,0.08); color:#fff; border:1px solid rgba(255,255,255,0.18);">
        ✕
      </button>
    </div>

    <div id="cartItems"
      style="display:flex; flex-direction:column; gap:10px; max-height:45vh; overflow:auto; padding-right:6px;">
      <!-- items here -->
    </div>

    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; margin-top:14px;">
      <div style="font-size:14px; opacity:.9;">
        Итого: <b id="cartTotalModal">0</b> ₽
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button id="checkoutBtn"
          style="cursor:pointer; border:0; border-radius:14px; padding:10px 14px; font-weight:900;
          background:linear-gradient(135deg,#ff4fb3,#ff86cf); color:#0b0c10;">
          Оформить (демо)
        </button>
      </div>
    </div>

  </div>
</div>
      <p style="opacity:.9; line-height:1.45; margin:0 0 12px;">
        Подарочный бокс: состав, преимущества, условия доставки, гарантия и ответы на вопросы.
      </p>

        <!-- Видеообзор -->
<div style="margin-top:18px; padding:16px; border-radius:16px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,79,179,0.35);
box-shadow: 0 10px 30px rgba(0,0,0,0.35), 0 0 0 2px rgba(255,79,179,0.10) inset;">

  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
    <div style="font-weight:750; letter-spacing:.2px;">Очень крутое видео</div>
    <div style="font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,79,179,0.16); border:1px solid rgba(255,79,179,0.35);">
      YouTube • встроенный плеер
    </div>
  </div>

  <div style="position:relative; width:100%; padding-top:56.25%; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,0.12);
background:rgba(255,255,255,0.04); box-shadow: 0 18px 40px rgba(0,0,0,0.55);">
    <iframe
      src="https://www.youtube.com/embed/phRn9Thc1zc"
      title="Очень крутое видео"
      style="position:absolute; inset:0; width:100%; height:100%; border:0;"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen>
    </iframe>
  </div>

  <div style="margin-top:10px; font-size:13px; opacity:.8; line-height:1.45;">
    Если видео не отображается, открой его в
    <a href="https://www.youtube.com/watch?v=phRn9Thc1zc" target="_blank" rel="noopener noreferrer"
       style="color:#ff86cf; text-decoration:none; border-bottom:1px dashed rgba(255,134,207,0.7);">
      YouTube
    </a>.
  </div>
</div>
<!-- Подписка -->
<div style="margin-top:16px; padding:16px; border-radius:16px; background:rgba(255,255,255,0.05);
border:1px solid rgba(255,79,179,0.28);">

  <div style="font-weight:750; margin-bottom:8px;">
    Получать новости и скидки
  </div>

  <form id="subscribeForm" style="display:flex; gap:10px; flex-wrap:wrap;">
    <input id="emailInput" type="email" required placeholder="Введите email"
      style="flex:1; min-width:220px; padding:12px 14px; border-radius:14px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(0,0,0,0.25); color:#fff; outline:none;" />

    <button type="submit"
      style="cursor:pointer; border:0; border-radius:14px;
      padding:12px 16px; font-weight:800;
      background:#fff; color:#0b0c10;">
      Подписаться
    </button>
  </form>

  <div style="margin-top:8px; font-size:12px; opacity:.75;">
    Учебная форма нужна для аналитики.
  </div>
</div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
          <button id="addToCartBtn" style="cursor:pointer; border:0; border-radius:14px; padding:12px 16px; font-weight:800;
background:rgba(255,255,255,0.06); color:#fff; border:1px solid rgba(255,79,179,0.45);">
  В корзину
</button>
        <button id="buyBtn2" style="cursor:pointer; border:0; border-radius:14px; padding:12px 16px; font-weight:700;
background:linear-gradient(135deg,#ff4fb3,#ff86cf); color:#0b0c10; box-shadow:0 10px 22px rgba(255,79,179,0.18);">
          Купить
        </button>

        <a href="./index.html" style="display:inline-block; border-radius:14px; padding:12px 16px; font-weight:600; color:#fff; text-decoration:none; border:1px solid rgba(255,255,255,0.22);">
          Идем на главную
        </a>
      </div>

    
  </div>

<script>
  // ===== Helpers =====
  const CART_KEY = 'minishop_cart_v1';

  function loadCart() {
    try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
    catch { return []; }
  }

  function saveCart(cart) {
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
  }

  function cartTotals(cart) {
    const count = cart.reduce((s, it) => s + it.qty, 0);
    const total = cart.reduce((s, it) => s + it.qty * it.price, 0);
    return { count, total };
  }

  function fireMetrika(goal) {
    try { window.ym && window.ym(106875241, 'reachGoal', goal); } catch(e) {}
  }

  function fireGA(eventName, params = {}) {
    try {
      window.gtag && gtag('event', eventName, {
        page_name: 'details',
        page_path: location.pathname,
        ...params
      });
    } catch(e) {}
  }

  // ===== DOM refs =====
  const buyBtn2 = document.getElementById('buyBtn2');
  const subscribeForm = document.getElementById('subscribeForm');

  const addToCartBtn = document.getElementById('addToCartBtn');
  const cartCount = document.getElementById('cartCount');
  const cartTotal = document.getElementById('cartTotal');
  const openCartBtn = document.getElementById('openCartBtn');
  const clearCartBtn = document.getElementById('clearCartBtn');

  const cartModal = document.getElementById('cartModal');
  const closeCartBtn = document.getElementById('closeCartBtn');
  const cartItems = document.getElementById('cartItems');
  const cartTotalModal = document.getElementById('cartTotalModal');
  const checkoutBtn = document.getElementById('checkoutBtn');

  // ===== Product (demo) =====
  const PRODUCT = {
    id: 'giftbox_1',
    name: 'Подарочный бокс "SWAGA"',
    price: 1290
  };

  // ===== UI render =====
  function renderCart() {
    const cart = loadCart();
    const { count, total } = cartTotals(cart);

    if (cartCount) cartCount.textContent = String(count);
    if (cartTotal) cartTotal.textContent = String(total);
    if (cartTotalModal) cartTotalModal.textContent = String(total);

    if (!cartItems) return;

    if (cart.length === 0) {
      cartItems.innerHTML = `
        <div style="padding:14px; border-radius:14px; background:rgba(255,255,255,0.05);
          border:1px solid rgba(255,255,255,0.12); opacity:.9;">
          Корзина пустая. Добавь товар кнопкой “В корзину”.
        </div>`;
      return;
    }

    cartItems.innerHTML = cart.map((it, idx) => `
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;
        padding:12px; border-radius:14px; background:rgba(255,255,255,0.05);
        border:1px solid rgba(255,255,255,0.12);">
        <div>
          <div style="font-weight:850;">${it.name}</div>
          <div style="font-size:13px; opacity:.85;">${it.price} ₽ · Кол-во: <b>${it.qty}</b></div>
        </div>

        <div style="display:flex; gap:8px; align-items:center;">
          <button data-action="minus" data-idx="${idx}"
            style="cursor:pointer; border:0; border-radius:12px; padding:8px 10px; font-weight:900;
            background:rgba(255,255,255,0.06); color:#fff; border:1px solid rgba(255,255,255,0.16);">−</button>

          <button data-action="plus" data-idx="${idx}"
            style="cursor:pointer; border:0; border-radius:12px; padding:8px 10px; font-weight:900;
            background:rgba(255,79,179,0.18); color:#fff; border:1px solid rgba(255,79,179,0.35);">+</button>

          <button data-action="remove" data-idx="${idx}"
            style="cursor:pointer; border:0; border-radius:12px; padding:8px 10px; font-weight:900;
            background:rgba(255,255,255,0.06); color:#fff; border:1px solid rgba(255,255,255,0.16);">Удалить</button>
        </div>
      </div>
    `).join('');
  }

function openModal() {
  cartModal.style.display = 'flex';
  cartModal.style.pointerEvents = 'auto';
  renderCart();
}

function closeModal() {
  cartModal.style.display = 'none';
  cartModal.style.pointerEvents = 'none';
}

  // ===== Cart actions =====
  function addToCart(product) {
    const cart = loadCart();
    const found = cart.find(it => it.id === product.id);
    if (found) found.qty += 1;
    else cart.push({ ...product, qty: 1 });
    saveCart(cart);
    renderCart();

    fireMetrika('add_to_cart');
    fireGA('add_to_cart', { item_id: product.id, item_name: product.name, price: product.price });

    if (addToCartBtn) {
      const old = addToCartBtn.textContent;
      addToCartBtn.textContent = 'Добавлено ✓';
      setTimeout(() => addToCartBtn.textContent = old, 900);
    }
  }

  function clearCart() {
    saveCart([]);
    renderCart();
    fireMetrika('cart_clear');
    fireGA('cart_clear');
  }

  // ===== Existing: BUY click =====
  if (buyBtn2) {
    buyBtn2.addEventListener('click', () => {
      fireMetrika('buy_click');
      fireGA('buy_click');

      alert('Покупка оформлена! 
            Деньги с карты не спишем :)');
    });
  }

  // ===== Subscribe form =====
  if (subscribeForm) {
    subscribeForm.addEventListener('submit', (e) => {
      e.preventDefault();

      fireMetrika('subscribe_submit');
      fireGA('subscribe_submit');

      alert('Спасибо за подписку! Обещаем не присылать спам');
      subscribeForm.reset();
    });
  }

  // ===== Wire cart buttons =====
  if (addToCartBtn) addToCartBtn.addEventListener('click', () => addToCart(PRODUCT));
  if (openCartBtn) openCartBtn.addEventListener('click', openModal);
  if (clearCartBtn) clearCartBtn.addEventListener('click', clearCart);
  if (closeCartBtn) closeCartBtn.addEventListener('click', closeModal);

  // click outside modal closes
  if (cartModal) {
    cartModal.addEventListener('click', (e) => {
      if (e.target === cartModal) closeModal();
    });
  }

  // handle +/-/remove in modal via event delegation
  if (cartItems) {
    cartItems.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;

      const action = btn.getAttribute('data-action');
      const idx = Number(btn.getAttribute('data-idx'));
      const cart = loadCart();
      if (!cart[idx]) return;

      if (action === 'plus') {
        cart[idx].qty += 1;
        fireGA('cart_qty_plus', { item_id: cart[idx].id });
      } else if (action === 'minus') {
        cart[idx].qty -= 1;
        fireGA('cart_qty_minus', { item_id: cart[idx].id });
        if (cart[idx].qty <= 0) cart.splice(idx, 1);
      } else if (action === 'remove') {
        fireGA('cart_remove', { item_id: cart[idx].id });
        cart.splice(idx, 1);
      }

      saveCart(cart);
      renderCart();
    });
  }

  // checkout demo
  if (checkoutBtn) {
    checkoutBtn.addEventListener('click', () => {
      const cart = loadCart();
      const { total, count } = cartTotals(cart);

      fireMetrika('checkout_demo');
      fireGA('checkout_demo', { total_value: total, items_count: count });

      alert('Оформление заказа (демо).');
      closeModal();
    });
  }

  // initial render
  renderCart();
</script>
    
</body>
</html>
