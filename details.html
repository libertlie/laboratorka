<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Подробнее — Pryles Shop</title>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=106875241', 'ym');

        ym(106875241, 'init', {
            ssr:true,
            webvisor:true,
            clickmap:true,
            ecommerce:"dataLayer",
            referrer: document.referrer,
            url: location.href,
            accurateTrackBounce:true,
            trackLinks:true
        });
    </script>
    <noscript>
        <div>
            <img src="https://mc.yandex.ru/watch/106875241"
                 style="position:absolute; left:-9999px;"
                 alt="" />
        </div>
    </noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PHBFB263');</script>
<!-- End Google Tag Manager -->
    
</head>

<body style="margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
background:
radial-gradient(700px 420px at 20% 10%, rgba(255,79,179,0.18), transparent 60%),
radial-gradient(620px 380px at 85% 15%, rgba(255,134,207,0.12), transparent 60%),
#0b0c10;
color:#f6f7fb;">
 <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PHBFB263"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  <div style="max-width:980px; margin:0 auto; padding:32px 16px 60px;">
    <div style="padding:22px; border-radius:18px; background:rgba(20, 12, 22, 0.75); border:1px solid rgba(255,79,179,0.35);">

      <h1 style="margin:0 0 10px; color:#fff;">Подробнее о продукте</h1>

      <p style="opacity:.9; line-height:1.45; margin:0 0 12px; color:rgba(255,255,255,0.88);">
        Подарочный бокс: состав, преимущества, условия доставки, гарантия и ответы на вопросы.
      </p>

      <!-- Мини-корзина (только счётчик) -->
      <div id="miniCart"
        style="margin-top:14px; padding:14px; border-radius:16px; background:rgba(255,255,255,0.05);
        border:1px solid rgba(255,79,179,0.28); display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">

        <div>
          <div style="font-weight:800;">Корзина</div>
          <div style="font-size:13px; opacity:.85;">
            Товаров: <b id="cartCount">0</b> · Сумма: <b id="cartTotal">0</b> ₽
          </div>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <a href="./cart.html" id="goToCartLink"
             style="display:inline-block; border-radius:14px; padding:10px 14px; font-weight:800;
             color:#fff; text-decoration:none; border:1px solid rgba(255,79,179,0.45); background:rgba(255,79,179,0.14);">
            Перейти в корзину
          </a>

          <button id="clearCartBtn"
            style="cursor:pointer; border:0; border-radius:14px; padding:10px 14px; font-weight:800;
            background:rgba(255,255,255,0.06); color:#fff; border:1px solid rgba(255,255,255,0.18);">
            Очистить
          </button>
        </div>
      </div>

      <!-- Видеообзор -->
      <div style="margin-top:18px; padding:16px; border-radius:16px; background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,79,179,0.35); box-shadow: 0 10px 30px rgba(0,0,0,0.35), 0 0 0 2px rgba(255,79,179,0.10) inset;">

        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-bottom:10px;">
          <div style="font-weight:750; letter-spacing:.2px;">Очень крутое видео</div>
          <div style="font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,79,179,0.16);
          border:1px solid rgba(255,79,179,0.35);">
            YouTube • встроенный плеер
          </div>
        </div>

        <div style="position:relative; width:100%; padding-top:56.25%; border-radius:14px; overflow:hidden;
        border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.04); box-shadow: 0 18px 40px rgba(0,0,0,0.55);">
          <iframe
            src="https://www.youtube.com/embed/phRn9Thc1zc"
            title="Очень крутое видео"
            style="position:absolute; inset:0; width:100%; height:100%; border:0;"
            loading="lazy"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>

        <div style="margin-top:10px; font-size:13px; opacity:.8; line-height:1.45;">
          Если видео не отображается, открой его в
          <a href="https://www.youtube.com/watch?v=phRn9Thc1zc" target="_blank" rel="noopener noreferrer"
             style="color:#ff86cf; text-decoration:none; border-bottom:1px dashed rgba(255,134,207,0.7);">
            YouTube
          </a>.
        </div>
      </div>

      <!-- Подписка -->
      <div style="margin-top:16px; padding:16px; border-radius:16px; background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,79,179,0.28);">

        <div style="font-weight:750; margin-bottom:8px;">Получать новости и скидки</div>

        <form id="subscribeForm" style="display:flex; gap:10px; flex-wrap:wrap;">
          <input id="emailInput" type="email" required placeholder="Введите email"
            style="flex:1; min-width:220px; padding:12px 14px; border-radius:14px;
            border:1px solid rgba(255,255,255,0.18);
            background:rgba(0,0,0,0.25); color:#fff; outline:none;" />

          <button type="submit"
            style="cursor:pointer; border:0; border-radius:14px; padding:12px 16px; font-weight:800;
            background:#fff; color:#0b0c10;">
            Подписаться
          </button>
        </form>

        <div style="margin-top:8px; font-size:12px; opacity:.75;">
          Учебная форма нужна для аналитики.
        </div>
      </div>

      <!-- Кнопки товара -->
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;">
        <button id="addToCartBtn"
          style="cursor:pointer; border:0; border-radius:14px; padding:12px 16px; font-weight:800;
          background:rgba(255,255,255,0.06); color:#fff; border:1px solid rgba(255,79,179,0.45);">
          В корзину
        </button>

        <button id="buyBtn2"
          style="cursor:pointer; border:0; border-radius:14px; padding:12px 16px; font-weight:900;
          background:linear-gradient(135deg,#ff4fb3,#ff86cf); color:#0b0c10; box-shadow:0 10px 22px rgba(255,79,179,0.18);">
          Купить
        </button>

        <a href="./index.html" id="backHome"
           style="display:inline-block; border-radius:14px; padding:12px 16px; font-weight:700; color:#fff;
           text-decoration:none; border:1px solid rgba(255,255,255,0.22);">
          Назад на главную
        </a>
      </div>

    </div>
  </div>

  <script>
  // =========================
  // DETAILS — ANALYTICS + CART
  // База для ЛР 7–10
  // =========================

  const MID = 106875241;

  // A/B: рандом КАЖДЫЙ ЗАХОД на страницу (удобно для лабы)
  const variant = Math.random() < 0.5 ? 'A' : 'B';

  // ----- helpers -----
  function fireM(goal, params = {}) {
    try { window.ym && window.ym(MID, 'reachGoal', goal, params); } catch(e) {}
  }

  function fireGA(name, params = {}) {
    try {
      window.gtag && gtag('event', name, {
        page_name: 'details',
        page_path: location.pathname,
        variant,
        ...params
      });
    } catch(e) {}
  }

  // ----- cart logic -----
  const CART_KEY = 'minishop_cart_v1';
  const PRODUCT = { id:'giftbox_1', name:'Подарочный бокс (демо)', price:1290 };

  function loadCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; } catch { return []; } }
  function saveCart(cart){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
  function totals(cart){
    const count = cart.reduce((s,it)=>s+it.qty,0);
    const total = cart.reduce((s,it)=>s+it.qty*it.price,0);
    return {count,total};
  }
  function addToCart(product){
    const cart = loadCart();
    const found = cart.find(it => it.id === product.id);
    if(found) found.qty += 1; else cart.push({...product, qty:1});
    saveCart(cart);
    return cart;
  }

  // ----- elements -----
  const cartCountEl = document.getElementById('cartCount');
  const cartTotalEl = document.getElementById('cartTotal');

  const clearCartBtn = document.getElementById('clearCartBtn');
  const addToCartBtn = document.getElementById('addToCartBtn');
  const buyBtn2 = document.getElementById('buyBtn2');
  const goToCartLink = document.getElementById('goToCartLink');

  const subscribeForm = document.getElementById('subscribeForm');
  const emailInput = document.getElementById('emailInput');

  function renderMiniCart(){
    const cart = loadCart();
    const {count,total} = totals(cart);
    if(cartCountEl) cartCountEl.textContent = String(count);
    if(cartTotalEl) cartTotalEl.textContent = String(total);
  }

  // =========================
  // 1) Просмотр карточки товара (при заходе на details)
  // =========================
  fireGA('view_item', {
    item_id: PRODUCT.id,
    item_name: PRODUCT.name,
    price: PRODUCT.price
  });
  fireM('view_item', { variant });

  // =========================
  // 2) Очистка корзины
  // =========================
  if(clearCartBtn){
    clearCartBtn.addEventListener('click', () => {
      saveCart([]);
      renderMiniCart();

      fireGA('cart_clear');
      fireM('cart_clear');
    });
  }

  // =========================
  // 3) Добавить в корзину
  // =========================
  if(addToCartBtn){
    addToCartBtn.addEventListener('click', () => {
      addToCart(PRODUCT);
      renderMiniCart();

      fireGA('add_to_cart', {
        item_id: PRODUCT.id,
        item_name: PRODUCT.name,
        price: PRODUCT.price
      });
      fireM('add_to_cart', { variant });

      const old = addToCartBtn.textContent;
      addToCartBtn.textContent = 'Добавлено ✓';
      setTimeout(() => addToCartBtn.textContent = old, 900);
    });
  }

  // =========================
  // 4) Перейти в корзину (логируем view_cart)
  // =========================
  if(goToCartLink){
    goToCartLink.addEventListener('click', () => {
      const cart = loadCart();
      const {count,total} = totals(cart);

      fireGA('view_cart', { cart_items: count, cart_total: total });
      fireM('view_cart', { variant });
      // Переход по href выполнится сам
    });
  }

  // =========================
  // 5) Купить -> begin_checkout + переход в cart.html
  // =========================
  if(buyBtn2){
    buyBtn2.addEventListener('click', () => {
      addToCart(PRODUCT);
      renderMiniCart();

      fireGA('begin_checkout', {
        item_id: PRODUCT.id,
        item_name: PRODUCT.name,
        price: PRODUCT.price
      });
      fireM('begin_checkout', { variant });

      setTimeout(() => {
        window.location.href = './cart.html';
      }, 150);
    });
  }

  // =========================
  // 6) Подписка: click + submit
  // =========================
  if(subscribeForm){
    // клик по кнопке
    subscribeForm.addEventListener('click', (e) => {
      const isBtn = e.target && e.target.tagName === 'BUTTON';
      if(!isBtn) return;

      fireGA('subscribe_click');
      fireM('subscribe_click');
    });

    // отправка формы
    subscribeForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const hasEmail = emailInput && emailInput.value ? 'yes' : 'no';

      fireGA('subscribe_submit', { has_email: hasEmail });
      fireM('subscribe_submit', { variant });

      alert('Подписка оформлена (демо).');
      subscribeForm.reset();
    });
  }

  // ----- init -----
  renderMiniCart();
</script>
</body>
    
</html>
